[~burmako] Can you give a little more context here?  What is the sequence of document-adding calls?  I haven't been able to stumble into a sequence that causes a problem, and looking at the code doesn't make anything jump out at me.  The logic is rather involved, so it could be possible, but a particular test case would be nice.  (Especially without all the actor stuff, assuming it's reproducible.)
