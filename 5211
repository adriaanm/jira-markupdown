Merging with scala/bug#7295, for which I've just submitted a fix.
