r19515 contains the fix necessary to make it to work in the build manager (i.e. it identifies the files necessary to compile). However the second bit necessary to close this ticket is a duplicate of SI-2443. In resident mode symbols of top level classes don't get removed which is why you get this weird behaviour even if A and B are in the same file.
