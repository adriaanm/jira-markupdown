My attempt at fixing scala/bug#4614 and scala/bug#4615. 
