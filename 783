This is essentially the same as bug scala/bug#883 (they differ in the details but it's the same phenomenon)
