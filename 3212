Fixed in r20501. All the cases mentioned in this ticket work as expected. However the bug turned out to be specific to sources in the default package, so it might well be that scala/bug#2767 is unrelated.
