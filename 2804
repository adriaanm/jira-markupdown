(In r20385) Closes SI-2657, SI-2789. Review by dragos.
