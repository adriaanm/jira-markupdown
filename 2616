The following optimization should help with arrays of many repeated elements, and should hardly have any impact otherwise:
```scala
       var a = off 
       var d = off + len - 1 
       while (a <= d && x(a) == v) a += 1
       while (d <= a && x(a) == v) d -= 1
       var b = a 
       var c = d 
       var done = b <= c
```

