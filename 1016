merging with scala/bug#2308, added test case there
