Consolidating this with scala/bug#7453.
