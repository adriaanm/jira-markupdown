See also scala/bug#1247 for the optimization I proposed.
