This will be very hard to get right. The info is no longer available at the point where it is needed. All type info is are deleted and then things are re-typechecked from the ground up with casts inserted. There's no room here for "what was the type before?".
