I've looked at the logic here closely and in fact I can't see an obvious indication of a race between FreshRunReq and ShutdownReq.

Note that the catching and handling of either of these will be the last action of the current runner thread.

Since this is the only thread that is dequeuing exceptions, then if a ShutdownReq is handled, any pending FreshRunReq's will be ignored.

Alternatively, if a FreshRunReq is handled, then a new runner thread will be created and the old thread will terminate without dequeuing any further exceptions. So any pending ShutdownReq will still be on the queue, hence the new runner thread will eventually dequeue it and shutdown.

Your example code in comment SI-13 behaves different, because it doesn't exhibit the same queuing behaviour.

So if there is a problem with askShutdown, I'm fairly confident this isn't it.

Can you give me some more detail about the behaviour you're observing?
