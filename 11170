I think I would simply change `get` to

{code}
    def get(key: A) = {
      val x = self.get(key)
      if(x.isDefined && p(key)) x else None
    }
{code}

This is about as efficient as before, but does not fail with predicates defined only on the contents of the map.
