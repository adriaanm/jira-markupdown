Ok, I attached a patch that solves the problem (by eliminating recursion) and a scalacheck test to ensure nothing was broken.

There is also a slight optimization, where {{swap(a,b)}} and {{swap(c, d)}} when {{a == b}} or {{c == d}}, respectively, are skipped.
