very similar to scala/bug#2187
