Implemented approximately as described in r23810.
