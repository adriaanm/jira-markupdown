(In r21866) Closes scala/bug#3407. Closes scala/bug#3412. Review by plocinic.
