Marking as a duplicate of scala/bug#9399, which is fixed in https://github.com/scala/scala/pull/4919. I've added the test case from this ticket.
