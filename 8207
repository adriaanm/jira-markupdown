I guess it would make sense to have it do something like:
{code}
  stack popAndCheck cm.consumedTypes
  cm.producedTypes foreach (stack push _)
{code}
And the same for all instructions. WDTY?
