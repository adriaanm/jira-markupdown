I guess it would make sense to have it do something like:
```scala
  stack popAndCheck cm.consumedTypes
  cm.producedTypes foreach (stack push _)
```
And the same for all instructions. WDTY?
