I attached a patch for replaceInstruction which takes the position of the instruction into account as well. Perhaps it would be even better if you iterate through the instructions *by index* in ClosureElimination and replace them by index...
