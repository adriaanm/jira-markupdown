This has some overlap with https://issues.scala-lang.org/browse/SI-8685, but that is a feature request and this is a bug report.
