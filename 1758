Duplicate of (part of) scala/bug#2685.
