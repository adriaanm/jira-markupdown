Pretty close cousin of scala/bug#4928
