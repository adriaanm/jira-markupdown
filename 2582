On the face of it it seems trivial to fix. If "end" is positive, substract one for the open range, leave the closed range alone, and use <= in the loop; if "end" is negative, add one for the open range, leave the closed range alone, and use >= in the loop.

Since we are subtracting from a positive or adding to a negative, we know there won't be an overflow.
