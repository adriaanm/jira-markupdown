I have a macro called {{snippet}} that I use to capture pieces of code and using the workaround mentioned by Johannes.

However it returns the same kind of compiler error: "contains nonsynthetic tree", on the following code:

{code}
snippet {
  object AnInt { def unapply(a: String): Option[Int] = Some(a.toInt)}
  def f: PartialFunction[String, Int] = { case AnInt(i)  => i }
}
{code}
