I'm going to merge this with scala/bug#3528. Thanks for the tiny minimization.
