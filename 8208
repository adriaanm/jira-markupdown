There's no need to replace current functionality in TypeFlowAnalysis, which is working fine as we all know.

Instead, further assertions can be added. In the example, before popping from the stack, an assert can be added to cross-check with {{cm.consumedTypes}}.
