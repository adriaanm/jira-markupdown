Curiously, the problem seems to be introduced by the cast to the abstract type.

If the abstract type is replaced by an extra generic parameter, everything works fine and compile

