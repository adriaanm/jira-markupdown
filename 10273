FWIW we ran into this issue upgrading code from 2.9.3 to 2.10.4 at Twitter. The patch fixes the problem in Jason's pull request (as does simple code refactoring).

The code in question looked like:

{noformat}
    def render(... args ...) = {
        out.in(str1) { ... out.in(str2) { ... } }
    }
{noformat}

The result compiled fine but let to VerifyErrors when the class file was loaded. Contrary to what is listed above, this code compiled and ran fine with 2.9.3. It is only broken with 2.10.4. Diffing the bytecode that is generated, the 2.9.3 code uses a longer sequence using invokevirtual whereas the 2.10.4 code uses a very short invokespecial sequence.

Given that it appears this is a regression in behavior, does it make sense to apply the fix to 2.10.5?

p.s. The workaround I took was to lift the body of the second argument to the "out.in(str1) {...}" expression out as a separate def.
