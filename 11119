This is a duplicate of scala/bug#8323 / scala/bug#8539. Workaround is to annotate the type of `isLeaf` or mark it non-final so that it isn't treated as a compile time constant.
