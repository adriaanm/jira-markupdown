A first draft that assumes SI-6408 is fixed by disallowing nested templates in universal traits.  Please review for correctness especially the section on when allocations occur.
