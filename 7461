I already pushed a fix for this, but it can be improved.  Also, the world of name mangling bugs became more interesting recently with scala/bug#5652, if you didn't see that one.
