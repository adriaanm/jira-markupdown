This is Scala 2.8.0.final or equally a more recent snapshot like scala-2.8.0.r22830-b20100824020153.

The following example makes the Redblack implementation behind SortedSet/SortedMap crash:
{code}
import scala.collection.immutable.SortedSet

abstract class OP
case class A(i: Int) extends OP
case class D(i: Int) extends OP
case class R(i: Int, j: Int) extends OP

val ops = List(A(6), A(10), A(12), A(14), A(16), A(17), A(19), A(21), A(22), A(24), A(29), D(10), A(10), D(10), A(10), D(12), A(12), D(12), A(12), R(16,30), D(17), D(19))

(SortedSet.empty[Int] /: ops) { case (s, A(i)) => s + i case (s, D(i)) => s - i case (s, R(i, j)) => s.range(i, j) }
{code}

Here is the JVM dump:
{code}
java.lang.RuntimeException: Defect: invariance violation at Empty
	at scala.collection.immutable.RedBlack$$NonEmpty.balRight$$1(RedBlack.scala:120)
	at scala.collection.immutable.RedBlack$$NonEmpty.delRight$$1(RedBlack.scala:127)
	at scala.collection.immutable.RedBlack$$NonEmpty.del(RedBlack.scala:149)
	at scala.collection.immutable.RedBlack$$NonEmpty.delLeft$$1(RedBlack.scala:123)
	at scala.collection.immutable.RedBlack$$NonEmpty.del(RedBlack.scala:148)
	at scala.collection.immutable.RedBlack$$Tree.delete(RedBlack.scala:36)
	at scala.collection.immutable.TreeSet.$$minus(TreeSet.scala:93)
	at scala.collection.immutable.TreeSet.$$minus(TreeSet.scala:47)
	at $$anonfun$$1.apply(<console>:17)
	at $$anonfun$$1.apply(<console>:17)
	at scala.collection.LinearSeqOptimized$$class.foldLeft(LinearSeqOptimized.sca...

{code}

Maybe some mistake from some literature has been copied here.  Something like this has happened to other libraries before.

It might help to look at the following proven implementation
http://isabelle.in.tum.de/dist/library/HOL/Library/RBT_Impl.html
