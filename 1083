Thanks for your patch.

I have applied it (with only minor lexical changes) in r15954. The test file has been added in r15955.
