(In r23555) Fixes scala/bug#3647, closes scala/bug#3647, adds a test case for it, and a missing test case for scala/bug#3935.

No review.
