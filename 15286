The following code triggers an AssertionError because of the usage of the extractor at `case a @ A (a.Ex(i))`.

{code}
object Extractor {
  
  case class A(a: Int) {
    def someOtherValue = 1
    
    object Ex {
      def unapply(i: Int): Option[Int] = Some(i + someOtherValue)
    }
  }

  def main(args : Array[String]) : Unit = {
    
    val a = A(42)
    val Ex2 = a.Ex
    
    a match {
      case a @ A (a.Ex(i)) =>
        println(i)
    }
  }
}
{code}

If I use `case a @ A (Ex2(i))` instead, then it works fine. This is with the latest trunk from this morning, but I can't tell whether it used to work before that.

{code}
java.lang.AssertionError: assertion failed
	at scala.Predef$$.assert(Predef.scala:79)
	at scala.tools.nsc.symtab.Symbols$$Symbol.rawInfo(Symbols.scala:788)
	at scala.tools.nsc.typechecker.Typers$$Typer.isStale(Typers.scala:534)
	at scala.tools.nsc.typechecker.Typers$$Typer.reallyExists(Typers.scala:526)
	at scala.tools.nsc.typechecker.Typers$$Typer.qualifies$$1(Typers.scala:3510)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedIdent$$1(Typers.scala:3528)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3960)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedQualifier(Typers.scala:4109)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedQualifier(Typers.scala:4115)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3928)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedApply$$1$$1.apply(Typers.scala:3248)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedApply$$1$$1.apply(Typers.scala:3248)
	at scala.tools.nsc.typechecker.Typers$$Typer.silent(Typers.scala:696)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedApply$$1(Typers.scala:3248)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3888)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedArg(Typers.scala:2106)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedArgs$$3.apply(Typers.scala:2116)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedArgs$$3.apply(Typers.scala:2115)
	at scala.collection.TraversableLike$$$$anonfun$$map$$1.apply(TraversableLike.scala:203)
	at scala.collection.TraversableLike$$$$anonfun$$map$$1.apply(TraversableLike.scala:203)
	at scala.collection.LinearSeqOptimized$$class.foreach(LinearSeqOptimized.scala:62)
	at scala.collection.immutable.List.foreach(List.scala:46)
	at scala.collection.TraversableLike$$class.map(TraversableLike.scala:203)
	at scala.collection.immutable.List.map(List.scala:46)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedArgs(Typers.scala:2115)
	at scala.tools.nsc.typechecker.Typers$$Typer.doTypedApply(Typers.scala:2315)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedApply$$1(Typers.scala:3264)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3888)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedBind$$1(Typers.scala:3015)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3745)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedPattern(Typers.scala:4130)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedCase(Typers.scala:1876)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedCases$$1.apply(Typers.scala:1899)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedCases$$1.apply(Typers.scala:1897)
	at scala.collection.immutable.List.loop$$1(List.scala:116)
	at scala.collection.immutable.List.mapConserve(List.scala:133)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedCases(Typers.scala:1897)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3785)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedBlock(Typers.scala:1858)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3733)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.transformedOrTyped(Typers.scala:4186)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedDefDef(Typers.scala:1740)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3706)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedStat$$1(Typers.scala:2032)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2100)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2100)
	at scala.collection.immutable.List.loop$$1(List.scala:116)
	at scala.collection.immutable.List.mapConserve(List.scala:133)
	at scala.collection.immutable.List.loop$$1(List.scala:120)
	at scala.collection.immutable.List.mapConserve(List.scala:133)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedStats(Typers.scala:2100)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedTemplate(Typers.scala:1500)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedModuleDef(Typers.scala:1309)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3700)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedStat$$1(Typers.scala:2032)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2100)
	at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2100)
	at scala.collection.immutable.List.loop$$1(List.scala:116)
	at scala.collection.immutable.List.mapConserve(List.scala:133)
	at scala.tools.nsc.typechecker.Typers$$Typer.typedStats(Typers.scala:2100)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3693)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4042)
	at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4090)
	at scala.tools.nsc.typechecker.Analyzer$$typerFactory$$$$anon$$3.apply(Analyzer.scala:86)
	at scala.tools.nsc.Global$$GlobalPhase$$$$anonfun$$applyPhase$$1.apply(Global.scala:272)
	at scala.tools.nsc.Global$$GlobalPhase$$$$anonfun$$applyPhase$$1.apply(Global.scala:272)
	at scala.tools.nsc.reporters.Reporter.withSource(Reporter.scala:49)
	at scala.tools.nsc.Global$$GlobalPhase.applyPhase(Global.scala:272)
	at scala.tools.nsc.interactive.Global$$TyperRun$$$$anonfun$$applyPhase$$1$$$$anonfun$$apply$$mcV$$sp$$1.apply(Global.scala:530)
	at scala.tools.nsc.interactive.Global$$TyperRun$$$$anonfun$$applyPhase$$1$$$$anonfun$$apply$$mcV$$sp$$1.apply(Global.scala:530)
	at scala.tools.nsc.symtab.SymbolTable.atPhase(SymbolTable.scala:104)
	at scala.tools.nsc.interactive.Global$$TyperRun$$$$anonfun$$applyPhase$$1.apply(Global.scala:530)
	at scala.tools.nsc.interactive.Global$$TyperRun$$$$anonfun$$applyPhase$$1.apply(Global.scala:530)
	at scala.tools.nsc.reporters.Reporter.withSource(Reporter.scala:49)
	at scala.tools.nsc.interactive.Global$$TyperRun.applyPhase(Global.scala:529)
	at scala.tools.nsc.interactive.Global$$TyperRun.typeCheck(Global.scala:483)
	at scala.tools.nsc.interactive.Global$$TyperRun.typedTree(Global.scala:520)
	at scala.tools.nsc.interactive.Global.typedTree(Global.scala:321)
	at scala.tools.nsc.interactive.Global$$$$anonfun$$getTypedTree$$1.apply(Global.scala:331)
	at scala.tools.nsc.interactive.Global$$$$anonfun$$getTypedTree$$1.apply(Global.scala:331)
	at scala.tools.nsc.interactive.Global.respond(Global.scala:276)
	at scala.tools.nsc.interactive.Global.getTypedTree(Global.scala:331)
	at scala.tools.nsc.interactive.CompilerControl$$$$anon$$3.apply$$mcV$$sp(CompilerControl.scala:95)
	at scala.tools.nsc.interactive.Global.pollForWork(Global.scala:132)
	at scala.tools.nsc.interactive.Global$$$$anon$$2.run(Global.scala:192)

{code}

Regards

Mirko
