Whittled down to:

{code}
class C
trait T { self: C =>
  def test = {
    object O

    class C {
      O
    }
    new C()
  }
}

object Test extends C with T {
  def main(args: Array[String]): Unit = {
    test
  }
}

{code}
