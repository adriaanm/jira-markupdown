```scala
import scala.reflect.runtime.universe._
import scala.reflect.runtime.{currentMirror => cm}
import scala.tools.reflect.ToolBox

object Test extends App {
  val toolbox = cm.mkToolBox()
  val tree = Block(Import(Ident(newTermName("scala")), List(ImportSelector(nme.WILDCARD, -1, null, -1))))
  toolbox.typeCheck(tree)
}
```

```scala
java.lang.AssertionError: assertion failed: already exists: package <root> . scala
  at scala.Predef$.assert(Predef.scala:162)
  at scala.reflect.runtime.JavaMirrors$class.missingHook(JavaMirrors.scala:933)
  at scala.tools.nsc.ReflectGlobal.missingHook(ReflectGlobal.scala:8)
  at scala.tools.nsc.typechecker.Typers$Typer.typedIdent$1(Typers.scala:4549)
  at scala.tools.nsc.typechecker.Typers$Typer.typed1(Typers.scala:4941)
  at scala.tools.nsc.typechecker.Typers$Typer.typed(Typers.scala:5037)
  at scala.tools.nsc.typechecker.Typers$Typer.typedQualifier(Typers.scala:5117)
  at scala.tools.nsc.typechecker.Typers$Typer.typedQualifier(Typers.scala:5125)
  at scala.tools.nsc.typechecker.Namers$Namer.getSig$1(Namers.scala:1310)
  at scala.tools.nsc.typechecker.Namers$Namer.typeSig(Namers.scala:1326)
  at scala.tools.nsc.typechecker.Namers$Namer$$anonfun$monoTypeCompleter$1$$anonfun$apply$3.apply$mcV$sp(Namers.scala:702)
  at scala.tools.nsc.typechecker.Namers$Namer$$anonfun$monoTypeCompleter$1$$anonfun$apply$3.apply(Namers.scala:701)
  at scala.tools.nsc.typechecker.Namers$Namer$$anonfun$monoTypeCompleter$1$$anonfun$apply$3.apply(Namers.scala:701)
  at scala.tools.nsc.typechecker.Namers$Namer$LogTransitions.apply(Namers.scala:1355)
  at scala.tools.nsc.typechecker.Namers$Namer.scala$tools$nsc$typechecker$Namers$Namer$$logAndValidate(Namers.scala:1364)
  at scala.tools.nsc.typechecker.Namers$Namer$$anonfun$monoTypeCompleter$1.apply(Namers.scala:701)
  at scala.tools.nsc.typechecker.Namers$Namer$$anonfun$monoTypeCompleter$1.apply(Namers.scala:700)
  at scala.Function1$class.apply$mcVL$sp(Function1.scala:39)
  at scala.runtime.AbstractFunction1.apply$mcVL$sp(AbstractFunction1.scala:12)
  at scala.tools.nsc.typechecker.Namers$$anon$1.completeImpl(Namers.scala:1467)
  at scala.tools.nsc.typechecker.Namers$LockingTypeCompleter$class.complete(Namers.scala:1475)
  at scala.tools.nsc.typechecker.Namers$$anon$1.complete(Namers.scala:1465)
  at scala.reflect.internal.Symbols$Symbol.info(Symbols.scala:1143)
  at scala.reflect.internal.Symbols$Symbol.initialize(Symbols.scala:1275)
  at scala.tools.nsc.typechecker.Typers$Typer.typedStat$1(Typers.scala:2547)
  at scala.tools.nsc.typechecker.Typers$Typer$$anonfun$65$$anonfun$66.apply(Typers.scala:2657)
  at scala.tools.nsc.typechecker.Typers$Typer$$anonfun$65$$anonfun$66.apply(Typers.scala:2657)
  at scala.collection.immutable.List.loop$1(List.scala:163)
  at scala.collection.immutable.List.mapConserve(List.scala:179)
  at scala.tools.nsc.typechecker.Typers$Typer$$anonfun$65.apply(Typers.scala:2657)
  at scala.tools.nsc.typechecker.Typers$Typer$$anonfun$65.apply(Typers.scala:2656)
  at scala.tools.nsc.typechecker.Typers$Typer.withSavedContext(Typers.scala:518)
  at scala.tools.nsc.typechecker.Typers$Typer.typedStats(Typers.scala:2656)
  at scala.tools.nsc.typechecker.Typers$Typer.typedBlock(Typers.scala:2148)
  at scala.tools.nsc.typechecker.Typers$Typer$$anonfun$typed1$4.apply(Typers.scala:4716)
  at scala.tools.nsc.typechecker.Typers$Typer$$anonfun$typed1$4.apply(Typers.scala:4716)
  at scala.tools.nsc.typechecker.Typers$Typer.typerWithLocalContext(Typers.scala:501)
  at scala.tools.nsc.typechecker.Typers$Typer.typed1(Typers.scala:4715)
  at scala.tools.nsc.typechecker.Typers$Typer.typed(Typers.scala:5037)
  at scala.tools.nsc.typechecker.Typers$Typer.typedBlock(Typers.scala:2149)
  at scala.tools.nsc.typechecker.Typers$Typer$$anonfun$typed1$4.apply(Typers.scala:4716)
  at scala.tools.nsc.typechecker.Typers$Typer$$anonfun$typed1$4.apply(Typers.scala:4716)
  at scala.tools.nsc.typechecker.Typers$Typer.typerWithLocalContext(Typers.scala:501)
  at scala.tools.nsc.typechecker.Typers$Typer.typed1(Typers.scala:4715)
  at scala.tools.nsc.typechecker.Typers$Typer.typed(Typers.scala:5037)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$typeCheckExpr$1$$anonfun$16.apply(ToolBoxFactory.scala:126)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$typeCheckExpr$1$$anonfun$16.apply(ToolBoxFactory.scala:126)
  at scala.tools.nsc.typechecker.Typers$Typer.silent(Typers.scala:717)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$typeCheckExpr$1.apply(ToolBoxFactory.scala:126)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$typeCheckExpr$1.apply(ToolBoxFactory.scala:126)
  at scala.tools.nsc.typechecker.Contexts$Context.withMacrosEnabled(Contexts.scala:221)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$14.apply(ToolBoxFactory.scala:118)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$14.apply(ToolBoxFactory.scala:118)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$wrapper$1$1.apply(ToolBoxFactory.scala:119)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$wrapper$1$1.apply(ToolBoxFactory.scala:119)
  at scala.tools.nsc.typechecker.Contexts$Context.withImplicitsEnabled(Contexts.scala:190)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$12.apply(ToolBoxFactory.scala:117)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal$$anonfun$12.apply(ToolBoxFactory.scala:117)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal.wrapper$1(ToolBoxFactory.scala:119)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl$ToolBoxGlobal.typeCheckExpr(ToolBoxFactory.scala:126)
  at scala.tools.reflect.ToolBoxFactory$ToolBoxImpl.typeCheck(ToolBoxFactory.scala:324)
  at Test$delayedInit$body.apply(toolbox_typecheck_implicitsdisabled.scala:8)
  at scala.Function0$class.apply$mcV$sp(Function0.scala:40)
  at scala.runtime.AbstractFunction0.apply$mcV$sp(AbstractFunction0.scala:12)
  at scala.App$$anonfun$main$1.apply(App.scala:61)
  at scala.App$$anonfun$main$1.apply(App.scala:61)
  at scala.collection.LinearSeqOptimized$class.foreach(LinearSeqOptimized.scala:59)
  at scala.collection.immutable.List.foreach(List.scala:77)
  at scala.collection.generic.TraversableForwarder$class.foreach(TraversableForwarder.scala:32)
  at scala.collection.mutable.ListBuffer.foreach(ListBuffer.scala:45)
  at scala.App$class.main(App.scala:61)
  at Test$.main(toolbox_typecheck_implicitsdisabled.scala:5)
  at Test.main(toolbox_typecheck_implicitsdisabled.scala)
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
  at java.lang.reflect.Method.invoke(Method.java:597)
  at scala.tools.nsc.util.ScalaClassLoader$$anonfun$run$1.apply(ScalaClassLoader.scala:93)
  at scala.tools.nsc.util.ScalaClassLoader$class.asContext(ScalaClassLoader.scala:41)
  at scala.tools.nsc.util.ScalaClassLoader$URLClassLoader.asContext(ScalaClassLoader.scala:162)
  at scala.tools.nsc.util.ScalaClassLoader$class.run(ScalaClassLoader.scala:93)
  at scala.tools.nsc.util.ScalaClassLoader$URLClassLoader.run(ScalaClassLoader.scala:162)
  at scala.tools.nsc.CommonRunner$class.run(ObjectRunner.scala:28)
  at scala.tools.nsc.ObjectRunner$.run(ObjectRunner.scala:45)
  at scala.tools.nsc.CommonRunner$class.runAndCatch(ObjectRunner.scala:35)
  at scala.tools.nsc.ObjectRunner$.runAndCatch(ObjectRunner.scala:45)
  at scala.tools.nsc.MainGenericRunner.runTarget$1(MainGenericRunner.scala:70)
  at scala.tools.nsc.MainGenericRunner.process(MainGenericRunner.scala:92)
  at scala.tools.nsc.MainGenericRunner$.main(MainGenericRunner.scala:101)
  at scala.tools.nsc.MainGenericRunner.main(MainGenericRunner.scala)
```
Bad stuff happens, because in order to typecheck an expression, toolbox creates a fake typer:

```scala
val ownerClass    = rootMirror.EmptyPackageClass.newClassSymbol(newTypeName("<expression-owner>"))
build.setTypeSignature(ownerClass, ClassInfoType(List(ObjectClass.tpe), newScope, ownerClass))
val owner         = ownerClass.newLocalDummy(expr.pos)
var currentTyper  = typer.atOwner(expr, owner)
```

This typer is good enough for the code without free variables, but its context is messed up, and it fails to find anything in scope.
