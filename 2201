The patch looks mostly good to me. Thanks Adriaan! In particular the points where you asked whether the original code is buggy probably need to be answered `yes'. 

There's just one thing where either I have not understood verything or a better solution might be possible. In patch clones type constraints in implicit search. That's certainly a way to do it. But could one not have achieved the same result with undo logic? I.e implicitSearch would set up a new undolog, and always reset that to what it was before. Also, context.undetparams would not be changed at all and implict search would not return a substitution. The idea (hope?) would be that the same substitution will be computed automatically afterwards when the implicit is applied or passed.

This design, if it works, would be simpler than the patch. So, maybe you can try thyat out Adriaan? But if you don't have time now, or it does not work out, the patch looks fine to me.

 -- Martin
