Fixed in r13978.
Deadlock is guaranteed not to occur because `Scheduler.snapshot` does not acquire the lock of `Scheduler$$`. The behavior is undefined if new tasks are submitted while the snapshot is acquired.
