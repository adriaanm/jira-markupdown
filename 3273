This looks very, very good (and fixes a lot of the residual case of SI-2767 as well).

Unfortunately tweaking the example slightly gets the originally reported error back,

{code}
package test

object Foo2 {
  object Foo {
  
  }
  case class Foo(t: String) {

  }
}
{code}
