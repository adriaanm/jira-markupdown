I think this is the cuprit here: 
```scala
     val middle = {
       val f = new File(filename)
       new SourceFileFragment(
           getSourceFile(new PlainFile(f)).asInstanceOf[BatchSourceFile],
           headerLength(filename),
           f.length.asInstanceOf[Int])
     }
```

Taking the length of the file as the length of fragment is going to mean that you will index past the end of the array because UTF8 uses multiple bytes per character.
