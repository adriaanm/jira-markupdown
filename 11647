I believe that this will also be fixed by the attendant changes to SI-8990.
See the PR I have so far here: https://github.com/scala/scala/pull/4284

Essentially, I argue that the WithFilter implementation should absolutely not be re-implementing map/flatMap/foreach, and should implement in terms of a call to #filter followed by the specific call.

Thoughts? I'm happy to add a test of this behavior to the same PR to try to see if we can solve both problems at the same time?
