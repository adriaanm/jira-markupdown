I was able to fix this, and the code in my comment in scala/bug#7753, without affecting either the original scala/bug#7753 or scala/bug#6161.
