Hello,

My project uses fair amount of implicits and type machinery in order to implement some DSL. I tried to port it to 2.8.0.RC1 but got stuck with the crash of the compiler (stack trace at the end). The interesting part is that it's simple code (test-case) that tries to use my dsl that crashes the compiler. That simple code is compiled at second run of the compiler independently from compiling dsl's api itself.

I tried to reduce my code to some minimal example but without of any luck. Any attempt to simplify my dsl resulted in crash disappearing. I hope that stacktrace will be specific enough for you to diagnose the problem.

Here is the stack-trace:
Exception in thread "main" java.util.NoSuchElementException: key not found: ?T                                  
        at scala.collection.MapLike$$class.default(MapLike.scala:224)                                            
        at scala.collection.immutable.Map$$Map1.default(Map.scala:94)                                            
        at scala.collection.MapLike$$class.apply(MapLike.scala:135)                                              
        at scala.collection.immutable.Map$$Map1.apply(Map.scala:94)                                              
        at scala.tools.nsc.symtab.Types$$CompoundType$$$$anon$$7.apply(Types.scala:1193)                            
        at scala.tools.nsc.symtab.Types$$CompoundType$$$$anon$$7.apply(Types.scala:1191)                            
        at scala.tools.nsc.symtab.Types$$TypeMap$$$$anonfun$$mapOverArgs$$1.apply(Types.scala:2904)                  
        at scala.tools.nsc.symtab.Types$$TypeMap$$$$anonfun$$mapOverArgs$$1.apply(Types.scala:2900)                  
        at scala.tools.nsc.symtab.Types$$class.map2Conserve(Types.scala:4592)                                    
        at scala.tools.nsc.symtab.SymbolTable.map2Conserve(SymbolTable.scala:14)                                
        at scala.tools.nsc.symtab.Types$$TypeMap.mapOverArgs(Types.scala:2900)                                   
        at scala.tools.nsc.symtab.Types$$TypeMap.mapOver(Types.scala:2810)                                       
        at scala.tools.nsc.symtab.Types$$CompoundType$$$$anon$$7.apply(Types.scala:1194)                            
        at scala.tools.nsc.symtab.Types$$CompoundType$$$$anon$$7.apply(Types.scala:1191)                            
        at scala.tools.nsc.symtab.Types$$TypeMap.mapOver(Types.scala:2834)                                       
        at scala.tools.nsc.symtab.Types$$CompoundType$$$$anon$$7.apply(Types.scala:1194)                            
        at scala.tools.nsc.symtab.Types$$CompoundType$$$$anon$$7.apply(Types.scala:1191)                            
        at scala.tools.nsc.symtab.Types$$TypeMap$$$$anonfun$$18.apply(Types.scala:2922)                             
        at scala.tools.nsc.symtab.Types$$TypeMap$$$$anonfun$$18.apply(Types.scala:2919)                             
        at scala.collection.LinearSeqOptimized$$class.exists(LinearSeqOptimized.scala:82)                        
        at scala.collection.immutable.List.exists(List.scala:46)                                                
        at scala.tools.nsc.symtab.Types$$TypeMap.mapOver(Types.scala:2919)                                       
        at scala.tools.nsc.symtab.Types$$TypeMap.mapOver(Types.scala:2912)                                       
        at scala.tools.nsc.symtab.Types$$CompoundType.baseTypeSeq(Types.scala:1203)                              
        at scala.tools.nsc.symtab.Types$$Type.baseTypeIndex(Types.scala:705)                                     
        at scala.tools.nsc.symtab.Types$$CompoundType.baseType(Types.scala:1269)                                 
        at scala.tools.nsc.symtab.Types$$TypeRef.baseType(Types.scala:1765)                                      
        at scala.tools.nsc.symtab.Types$$SimpleTypeProxy$$class.baseType(Types.scala:197)                         
        at scala.tools.nsc.symtab.Types$$SingletonType.baseType(Types.scala:968)                                 
        at scala.tools.nsc.symtab.Types$$AsSeenFromMap.base(Types.scala:3121)                                    
        at scala.tools.nsc.symtab.Types$$AsSeenFromMap.toPrefix$$1(Types.scala:3146)                              
        at scala.tools.nsc.symtab.Types$$AsSeenFromMap.apply(Types.scala:3148)                                   
        at scala.tools.nsc.symtab.Types$$AsSeenFromMap.apply(Types.scala:3070)                                   
        at scala.tools.nsc.symtab.Types$$TypeMap.mapOver(Types.scala:2804)                                       
        at scala.tools.nsc.symtab.Types$$AsSeenFromMap.apply(Types.scala:3194)                                   
        at scala.tools.nsc.symtab.Types$$AsSeenFromMap.apply(Types.scala:3070)                                   
        at scala.tools.nsc.symtab.Types$$TypeMap$$$$anonfun$$18.apply(Types.scala:2922)                             
        at scala.tools.nsc.symtab.Types$$TypeMap$$$$anonfun$$18.apply(Types.scala:2919)                             
        at scala.collection.LinearSeqOptimized$$class.exists(LinearSeqOptimized.scala:82)                        
        at scala.collection.immutable.List.exists(List.scala:46)                                                
        at scala.tools.nsc.symtab.Types$$TypeMap.mapOver(Types.scala:2919)                                       
        at scala.tools.nsc.symtab.Types$$TypeMap.mapOver(Types.scala:2824)                                       
        at scala.tools.nsc.symtab.Types$$AsSeenFromMap.apply(Types.scala:3194)                                   
        at scala.tools.nsc.symtab.Types$$Type.asSeenFrom(Types.scala:504)                                        
        at scala.tools.nsc.symtab.Types$$Type.memberInfo(Types.scala:513)                                        
        at scala.tools.nsc.symtab.Types$$class.scala$$tools$$nsc$$symtab$$Types$$$$specializesSym(Types.scala:4466)    
        at scala.tools.nsc.symtab.Types$$$$anonfun$$specializesSym$$1.apply(Types.scala:4460)                       
        at scala.tools.nsc.symtab.Types$$$$anonfun$$specializesSym$$1.apply(Types.scala:4460)                       
        at scala.collection.LinearSeqOptimized$$class.exists(LinearSeqOptimized.scala:82)                        
        at scala.collection.immutable.List.exists(List.scala:46)                                                
        at scala.tools.nsc.symtab.Types$$class.specializesSym(Types.scala:4459)                                  
        at scala.tools.nsc.symtab.SymbolTable.specializesSym(SymbolTable.scala:14)                              
        at scala.tools.nsc.symtab.Types$$Type.specializes(Types.scala:656)                                       
        at scala.tools.nsc.symtab.Types$$$$anonfun$$thirdTry$$1$$2.apply(Types.scala:4367)                           
        at scala.tools.nsc.symtab.Types$$$$anonfun$$thirdTry$$1$$2.apply(Types.scala:4367)                           
        at scala.collection.LinearSeqOptimized$$class.forall(LinearSeqOptimized.scala:72)                        
        at scala.collection.immutable.List.forall(List.scala:46)                                                
        at scala.tools.nsc.symtab.Types$$class.thirdTry$$1(Types.scala:4367)                                      
        at scala.tools.nsc.symtab.Types$$class.secondTry$$1(Types.scala:4327)                                     
        at scala.tools.nsc.symtab.Types$$class.firstTry$$1(Types.scala:4304)                                      
        at scala.tools.nsc.symtab.Types$$class.scala$$tools$$nsc$$symtab$$Types$$$$isSubType2(Types.scala:4443)        
        at scala.tools.nsc.symtab.Types$$$$anonfun$$isSubType$$1.apply$$mcZ$$sp(Types.scala:4157)                     
        at scala.tools.nsc.symtab.Types$$undoLog$$.undoUnless(Types.scala:127)                                    
        at scala.tools.nsc.symtab.Types$$class.isSubType(Types.scala:4144)                                       
        at scala.tools.nsc.symtab.SymbolTable.isSubType(SymbolTable.scala:14)                                   
        at scala.tools.nsc.symtab.Types$$Type.$$less$$colon$$less(Types.scala:589)                                  
        at scala.tools.nsc.typechecker.Infer$$Inferencer.isCompatible(Infer.scala:443)                           
        at scala.tools.nsc.typechecker.Infer$$Inferencer.isWeaklyCompatible(Infer.scala:488)                     
        at scala.tools.nsc.typechecker.Infer$$Inferencer.isConservativelyCompatible(Infer.scala:499)             
        at scala.tools.nsc.typechecker.Infer$$Inferencer.protoTypeArgs(Infer.scala:611)                          
        at scala.tools.nsc.typechecker.Typers$$Typer.doTypedApply(Typers.scala:2470)                             
        at scala.tools.nsc.typechecker.Typers$$Typer.typedApply$$1(Typers.scala:3373)                             
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3997)                                   
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch.typedImplicit0(Implicits.scala:447)             
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch.typedImplicit(Implicits.scala:354)              
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch.tryImplicit$$1(Implicits.scala:598)              
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch$$$$anonfun$$addAppInfos$$1$$1.apply(Implicits.scala:606)
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch$$$$anonfun$$addAppInfos$$1$$1.apply(Implicits.scala:603)
        at scala.collection.LinearSeqOptimized$$class.foreach(LinearSeqOptimized.scala:62)                          
        at scala.collection.immutable.List.foreach(List.scala:46)                                                  
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch.addAppInfos$$1(Implicits.scala:603)                 
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch$$$$anonfun$$applicableInfos$$1.apply(Implicits.scala:615)
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch$$$$anonfun$$applicableInfos$$1.apply(Implicits.scala:615)
        at scala.collection.LinearSeqOptimized$$class.foreach(LinearSeqOptimized.scala:62)                            
        at scala.collection.immutable.List.foreach(List.scala:46)                                                    
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch.applicableInfos(Implicits.scala:615)                 
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch.searchImplicit(Implicits.scala:639)                  
        at scala.tools.nsc.typechecker.Implicits$$ImplicitSearch.bestImplicit(Implicits.scala:886)                    
        at scala.tools.nsc.typechecker.Implicits$$class.inferImplicit(Implicits.scala:52)                             
        at scala.tools.nsc.Global$$analyzer$$.inferImplicit(Global.scala:291)                                          
        at scala.tools.nsc.typechecker.Typers$$Typer.wrapImplicit$$1(Typers.scala:233)                                 
        at scala.tools.nsc.typechecker.Typers$$Typer.inferView(Typers.scala:237)                                      
        at scala.tools.nsc.typechecker.Typers$$Typer.adaptToMember(Typers.scala:1052)                                 
        at scala.tools.nsc.typechecker.Typers$$Typer.adaptToName(Typers.scala:1092)                                   
        at scala.tools.nsc.typechecker.Typers$$Typer.typedSelect$$1(Typers.scala:3539)                                 
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:4058)                                        
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedApply$$1$$1.apply(Typers.scala:3357)                 
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedApply$$1$$1.apply(Typers.scala:3357)                 
        at scala.tools.nsc.typechecker.Typers$$Typer.silent(Typers.scala:731)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.typedApply$$1(Typers.scala:3357)                                  
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3997)                                        
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4212)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.typedFunction(Typers.scala:2087)                                 
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3869)                                        
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.typedArg(Typers.scala:2215)                                      
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedArgs$$3.apply(Typers.scala:2225)                    
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$typedArgs$$3.apply(Typers.scala:2224)                    
        at scala.collection.TraversableLike$$$$anonfun$$map$$1.apply(TraversableLike.scala:203)                          
        at scala.collection.TraversableLike$$$$anonfun$$map$$1.apply(TraversableLike.scala:203)                          
        at scala.collection.LinearSeqOptimized$$class.foreach(LinearSeqOptimized.scala:62)                            
        at scala.collection.immutable.List.foreach(List.scala:46)                                                    
        at scala.collection.TraversableLike$$class.map(TraversableLike.scala:203)                                     
        at scala.collection.immutable.List.map(List.scala:46)                                                        
        at scala.tools.nsc.typechecker.Typers$$Typer.typedArgs(Typers.scala:2224)                                     
        at scala.tools.nsc.typechecker.Typers$$Typer.doTypedApply(Typers.scala:2423)                                  
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$tryTypedApply$$1$$1.apply(Typers.scala:3312)              
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$tryTypedApply$$1$$1.apply(Typers.scala:3312)              
        at scala.tools.nsc.typechecker.Typers$$Typer.silent(Typers.scala:725)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.tryTypedApply$$1(Typers.scala:3312)                               
        at scala.tools.nsc.typechecker.Typers$$Typer.typedApply$$1(Typers.scala:3371)                                  
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3997)                                        
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4212)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.computeType(Typers.scala:4288)                                   
        at scala.tools.nsc.typechecker.Namers$$Namer.typeSig(Namers.scala:1165)                                       
        at scala.tools.nsc.typechecker.Namers$$Namer$$$$anonfun$$typeCompleter$$1.apply(Namers.scala:518)                 
        at scala.tools.nsc.typechecker.Namers$$Namer$$$$anonfun$$typeCompleter$$1.apply(Namers.scala:516)                 
        at scala.tools.nsc.typechecker.Namers$$$$anon$$1.complete(Namers.scala:1329)                                    
        at scala.tools.nsc.typechecker.Namers$$$$anon$$1.complete(Namers.scala:1327)                                    
        at scala.tools.nsc.symtab.Symbols$$Symbol.info(Symbols.scala:742)                                             
        at scala.tools.nsc.symtab.Symbols$$Symbol.initialize(Symbols.scala:854)                                       
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3793)                                        
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.typedStat$$1(Typers.scala:2141)                                   
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2209)                             
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2209)                             
        at scala.collection.immutable.List.loop$$1(List.scala:116)                                                    
        at scala.collection.immutable.List.mapConserve(List.scala:133)                                               
        at scala.tools.nsc.typechecker.Typers$$Typer.typedStats(Typers.scala:2209)                                    
        at scala.tools.nsc.typechecker.Typers$$Typer.typedBlock(Typers.scala:1966)                                    
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3842)                                        
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4212)                                         
        at scala.tools.nsc.typechecker.Typers$$Typer.computeType(Typers.scala:4288)
        at scala.tools.nsc.typechecker.Namers$$Namer.methodSig(Namers.scala:919)
        at scala.tools.nsc.typechecker.Namers$$Namer.typeSig(Namers.scala:1154)
        at scala.tools.nsc.typechecker.Namers$$Namer$$$$anonfun$$typeCompleter$$1.apply(Namers.scala:518)
        at scala.tools.nsc.typechecker.Namers$$Namer$$$$anonfun$$typeCompleter$$1.apply(Namers.scala:516)
        at scala.tools.nsc.typechecker.Namers$$$$anon$$1.complete(Namers.scala:1329)
        at scala.tools.nsc.typechecker.Namers$$$$anon$$1.complete(Namers.scala:1327)
        at scala.tools.nsc.symtab.Symbols$$Symbol.info(Symbols.scala:742)
        at scala.tools.nsc.symtab.Symbols$$Symbol.initialize(Symbols.scala:854)
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3793)
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)
        at scala.tools.nsc.typechecker.Typers$$Typer.typedStat$$1(Typers.scala:2141)
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2209)
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2209)
        at scala.collection.immutable.List.loop$$1(List.scala:116)
        at scala.collection.immutable.List.mapConserve(List.scala:133)
        at scala.collection.immutable.List.loop$$1(List.scala:120)
        at scala.collection.immutable.List.mapConserve(List.scala:133)
        at scala.collection.immutable.List.loop$$1(List.scala:120)
        at scala.collection.immutable.List.mapConserve(List.scala:133)
        at scala.tools.nsc.typechecker.Typers$$Typer.typedStats(Typers.scala:2209)
        at scala.tools.nsc.typechecker.Typers$$Typer.typedTemplate(Typers.scala:1528)
        at scala.tools.nsc.typechecker.Typers$$Typer.typedClassDef(Typers.scala:1309)
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3806)
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)
        at scala.tools.nsc.typechecker.Typers$$Typer.typedStat$$1(Typers.scala:2141)
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2209)
        at scala.tools.nsc.typechecker.Typers$$Typer$$$$anonfun$$20.apply(Typers.scala:2209)
        at scala.collection.immutable.List.loop$$1(List.scala:116)
        at scala.collection.immutable.List.mapConserve(List.scala:133)
        at scala.tools.nsc.typechecker.Typers$$Typer.typedStats(Typers.scala:2209)
        at scala.tools.nsc.typechecker.Typers$$Typer.typed1(Typers.scala:3802)
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4151)
        at scala.tools.nsc.typechecker.Typers$$Typer.typed(Typers.scala:4199)
        at scala.tools.nsc.typechecker.Analyzer$$typerFactory$$$$anon$$3.apply(Analyzer.scala:85)
        at scala.tools.nsc.Global$$GlobalPhase$$$$anonfun$$applyPhase$$1.apply(Global.scala:272)
        at scala.tools.nsc.Global$$GlobalPhase$$$$anonfun$$applyPhase$$1.apply(Global.scala:272)
        at scala.tools.nsc.reporters.Reporter.withSource(Reporter.scala:49)
        at scala.tools.nsc.Global$$GlobalPhase.applyPhase(Global.scala:272)
        at scala.tools.nsc.typechecker.Analyzer$$typerFactory$$$$anon$$3$$$$anonfun$$run$$1.apply(Analyzer.scala:80)
        at scala.tools.nsc.typechecker.Analyzer$$typerFactory$$$$anon$$3$$$$anonfun$$run$$1.apply(Analyzer.scala:80)
        at scala.collection.Iterator$$class.foreach(Iterator.scala:627)
        at scala.collection.mutable.ListBuffer$$$$anon$$1.foreach(ListBuffer.scala:305)
        at scala.tools.nsc.typechecker.Analyzer$$typerFactory$$$$anon$$3.run(Analyzer.scala:80)
        at scala.tools.nsc.Global$$Run.compileSources(Global.scala:729)
        at scala.tools.nsc.Global$$Run.compile(Global.scala:815)
        at scala.tools.nsc.Main$$.process(Main.scala:109)
        at scala.tools.nsc.Main$$.main(Main.scala:123)
        at scala.tools.nsc.Main.main(Main.scala)
I've managed to come up with minimal test-case:
```scala
object TestCase {

  //now matter if you put (abstract) class or trait it will fail in all cases
  trait MapOps[T]
  
  //if fs was reduced to List (generic type with one parameter) then the code compiles
  //if you inherit from MapOps[T] instead of MapOps[F] then code compiles fine
  implicit def map2ops[T,F](fs: Map[T,F]) = new MapOps[F] {
    //if you remove this line, then code compiles
    val m: Manifest[T] = error("just something to make it compile")
    def is(xs: List[T]) = List(xs)
  }

  def main(args: Array[String]) {
    Map(1 -> "2") is List(2)
  }

}
```
