(In r23322) Closes SI-3670, SI-3877. Plus with some additional lazy val checking we avoid adding bitmaps that are overshadowed by other bitmaps. Review by dragos.
