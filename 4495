(In r23322) Closes scala/bug#3670, scala/bug#3877. Plus with some additional lazy val checking we avoid adding bitmaps that are overshadowed by other bitmaps. Review by dragos.
